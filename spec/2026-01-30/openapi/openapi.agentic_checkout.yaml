openapi: 3.1.0
info:
  title: Agentic Checkout API
  version: "2026-01-30"
  description: |
    Merchant-implemented REST API for ChatGPT-driven checkout.
    Implements create, update (POST), retrieve (GET), complete, and cancel of checkout sessions.
servers:
  - url: https://merchant.example.com
security:
  - bearerAuth: []
tags:
  - name: CheckoutSessions
    description: Create and manage checkout sessions

paths:
  /checkout_sessions:
    post:
      tags: [CheckoutSessions]
      summary: Create a checkout session
      operationId: createCheckoutSession
      description: |
        Initializes a new checkout session from items and (optionally) buyer and fulfillment info.
        MUST return 201 with a rich, authoritative cart state.

        Agents MAY include `affiliate_attribution` with `touchpoint: "first"` to record first-touch attribution.
        This enables multi-touch attribution models where networks can capture both first and last touch.
      parameters:
        - $ref: "#/components/parameters/Authorization"
        - $ref: "#/components/parameters/ContentType"
        - $ref: "#/components/parameters/AcceptLanguage"
        - $ref: "#/components/parameters/UserAgent"
        - $ref: "#/components/parameters/IdempotencyKey"
        - $ref: "#/components/parameters/RequestId"
        - $ref: "#/components/parameters/Signature"
        - $ref: "#/components/parameters/Timestamp"
        - $ref: "#/components/parameters/APIVersion"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CheckoutSessionCreateRequest"
            examples:
              minimal:
                summary: Single item; no fulfillment details
                value:
                  items:
                    - id: "item_123"
                      quantity: 1
              with_address:
                summary: Single item with shipping address
                value:
                  items:
                    - id: "item_456"
                      quantity: 1
                  fulfillment_details:
                    name: "test"
                    phone_number: "15551234567"
                    email: "test@example.com"
                    address:
                      name: "test"
                      line_one: "555 Golden Gate Avenue"
                      line_two: "Apt 401"
                      city: "San Francisco"
                      state: "CA"
                      country: "US"
                      postal_code: "94102"
              with_first_touch_attribution:
                summary: With first-touch affiliate attribution
                value:
                  items:
                    - id: "item_123"
                      quantity: 1
                  affiliate_attribution:
                    provider: "impact.com"
                    token: "atp_01J8Z3WXYZ9ABC"
                    publisher_id: "pub_123"
                    touchpoint: "first"
      responses:
        "201":
          description: Created
          headers:
            Idempotency-Key:
              description: Echo of the request idempotency key
              schema: { type: string }
            Request-Id:
              description: Echo of the request correlation id
              schema: { type: string }
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CheckoutSession"
        "4XX":
          description: Client error
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "5XX":
          description: Server error
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }

  /checkout_sessions/{checkout_session_id}:
    parameters:
      - $ref: "#/components/parameters/Authorization"
      - $ref: "#/components/parameters/AcceptLanguage"
      - $ref: "#/components/parameters/UserAgent"
      - $ref: "#/components/parameters/IdempotencyKey"
      - $ref: "#/components/parameters/RequestId"
      - $ref: "#/components/parameters/Signature"
      - $ref: "#/components/parameters/Timestamp"
      - $ref: "#/components/parameters/APIVersion"
      - name: checkout_session_id
        in: path
        required: true
        description: "Unique identifier for the checkout session"
        schema: { type: string }
    post:
      tags: [CheckoutSessions]
      summary: Update a checkout session
      operationId: updateCheckoutSession
      description: |
        Applies changes (items, fulfillment address, fulfillment option) and returns an updated authoritative cart state.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CheckoutSessionUpdateRequest"
            examples:
              set_fulfillment_option:
                summary: Select a fulfillment option
                value:
                  selected_fulfillment_options:
                    - type: "shipping"
                      shipping:
                        option_id: "fulfillment_option_456"
                        item_ids: ["item_123"]
      responses:
        "200":
          description: Updated session
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CheckoutSession"
        "4XX":
          description: Client error
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "5XX":
          description: Server error
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }

    get:
      tags: [CheckoutSessions]
      summary: Retrieve a checkout session
      operationId: getCheckoutSession
      description: Returns the latest authoritative state for the checkout session.
      responses:
        "200":
          description: Current session
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CheckoutSession"
        "404":
          description: Session not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }

  /checkout_sessions/{checkout_session_id}/complete:
    parameters:
      - $ref: "#/components/parameters/Authorization"
      - $ref: "#/components/parameters/ContentType"
      - $ref: "#/components/parameters/AcceptLanguage"
      - $ref: "#/components/parameters/UserAgent"
      - $ref: "#/components/parameters/IdempotencyKey"
      - $ref: "#/components/parameters/RequestId"
      - $ref: "#/components/parameters/Signature"
      - $ref: "#/components/parameters/Timestamp"
      - $ref: "#/components/parameters/APIVersion"
      - name: checkout_session_id
        in: path
        required: true
        description: "Unique identifier for the checkout session"
        schema: { type: string }
    post:
      tags: [CheckoutSessions]
      summary: Complete a checkout session
      operationId: completeCheckoutSession
      description: |
        Finalizes the checkout by applying a payment method. MUST create an order and return completed state on success.

        Agents MAY include `affiliate_attribution` to ensure the merchant receives final attribution context.
        Attribution is stored alongside the resulting order but not returned in the response.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CheckoutSessionCompleteRequest"
            examples:
              basic:
                summary: Complete with payment data
                value:
                  buyer:
                    first_name: "John"
                    last_name: "Smith"
                    email: "johnsmith@mail.com"
                  payment_data:
                    token: "spt_123"
                    provider: "stripe"
              with_affiliate_attribution:
                summary: Complete with last-touch affiliate attribution
                value:
                  buyer:
                    first_name: "John"
                    last_name: "Smith"
                    email: "johnsmith@mail.com"
                  payment_data:
                    token: "spt_123"
                    provider: "stripe"
                  affiliate_attribution:
                    provider: "impact.com"
                    token: "atp_01J8Z3WXYZ9ABC"
                    publisher_id: "pub_123"
                    touchpoint: "last"
      responses:
        "200":
          description: Completed session with order
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CheckoutSessionWithOrder"
        "4XX":
          description: Client error
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "5XX":
          description: Server error
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }

  /checkout_sessions/{checkout_session_id}/cancel:
    parameters:
      - $ref: "#/components/parameters/Authorization"
      - $ref: "#/components/parameters/AcceptLanguage"
      - $ref: "#/components/parameters/UserAgent"
      - $ref: "#/components/parameters/IdempotencyKey"
      - $ref: "#/components/parameters/RequestId"
      - $ref: "#/components/parameters/Signature"
      - $ref: "#/components/parameters/Timestamp"
      - $ref: "#/components/parameters/APIVersion"
      - name: checkout_session_id
        in: path
        required: true
        description: "Unique identifier for the checkout session"
        schema: { type: string }
    post:
      tags: [CheckoutSessions]
      summary: Cancel a checkout session
      operationId: cancelCheckoutSession
      description: |
        Cancels a session if not already completed or canceled.
        Agents MAY include an intent_trace to communicate why the session is being abandoned.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CancelSessionRequest"
      responses:
        "200":
          description: Canceled session
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CheckoutSession"
        "405":
          description: Not cancelable (already completed/canceled)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: API Key

  parameters:
    Authorization:
      name: Authorization
      in: header
      required: true
      description: "Bearer token for API authentication"
      schema: { type: string, example: "Bearer api_key_123" }
    ContentType:
      name: Content-Type
      in: header
      required: true
      description: "Must be application/json for requests with a body"
      schema: { type: string, example: "application/json" }
    AcceptLanguage:
      name: Accept-Language
      in: header
      required: false
      description: "Preferred language for response messages"
      schema: { type: string, example: "en-US" }
    UserAgent:
      name: User-Agent
      in: header
      required: false
      description: "Client application identifier"
      schema:
        {
          type: string,
          example: "ChatGPT/2.0 (Mac OS X 15.0.1; arm64; build 0)",
        }
    IdempotencyKey:
      name: Idempotency-Key
      in: header
      required: false
      description: "Unique key to safely retry requests without duplicate processing"
      schema: { type: string, example: "idempotency_key_123" }
    RequestId:
      name: Request-Id
      in: header
      required: false
      description: "Unique identifier for request tracking and debugging"
      schema: { type: string, example: "request_id_123" }
    Signature:
      name: Signature
      in: header
      required: false
      description: "HMAC signature for webhook verification"
      schema: { type: string, example: "ZXltZX..." }
    Timestamp:
      name: Timestamp
      in: header
      required: false
      description: "RFC 3339 date-time string for request timing validation"
      schema:
        { type: string, format: date-time, example: "2026-01-30T10:30:00Z" }
    APIVersion:
      name: API-Version
      in: header
      required: true
      description: "API version date in YYYY-MM-DD format"
      schema: { type: string, example: "2026-01-30" }

  schemas:
    Address:
      type: object
      additionalProperties: false
      properties:
        name: { type: string, description: "Recipient name for this address" }
        line_one: { type: string, description: "Primary street address line" }
        line_two: { type: string, description: "Secondary address line (apartment, suite, etc.)" }
        city: { type: string, description: "City name" }
        state: { type: string, description: "State or province code" }
        country: { type: string, description: "ISO 3166-1 alpha-2 country code" }
        postal_code: { type: string, description: "Postal or ZIP code" }
      required: [name, line_one, city, state, country, postal_code]
      example:
        name: "Jane Doe"
        line_one: "123 Main Street"
        line_two: "Apt 4B"
        city: "New York"
        state: "NY"
        country: "US"
        postal_code: "10001"

    AffiliateAttributionSource:
      type: object
      additionalProperties: false
      description: Context about where the attribution originated.
      properties:
        type:
          type: string
          enum: [url, platform, unknown]
          description: The type of attribution source.
        url:
          type: string
          format: uri
          description: Canonical content URL when type is 'url'.
      required: [type]
      example:
        type: "url"
        url: "https://example.com/product-review"

    AffiliateAttributionMetadata:
      type: object
      additionalProperties:
        oneOf:
          - type: string
          - type: number
          - type: boolean
      description: |
        Flat key/value map for additional non-sensitive context.
        Keys must be strings; values must be strings, numbers, or booleans.
        Arrays and nested objects are NOT permitted.
      example:
        campaign_type: "influencer"
        commission_rate: 0.15
        is_verified: true

    AffiliateAttribution:
      type: object
      description: |
        Optional affiliate attribution data for crediting third-party publishers.
        Write-only: not returned in responses. See RFC: Affiliate Attribution.

        Forward compatibility: Servers SHOULD ignore unknown fields to support future extensions (per RFC §8.2).
      properties:
        provider:
          type: string
          description: Identifier for the attribution provider / affiliate network namespace (e.g., 'impact.com').
        token:
          type: string
          description: Opaque provider-issued token for fraud-resistant validation. Treat as secret.
        publisher_id:
          type: string
          description: Provider-scoped affiliate/publisher identifier. Required if token is omitted.
        campaign_id:
          type: string
          description: Provider-scoped campaign identifier.
        creative_id:
          type: string
          description: Provider-scoped creative identifier.
        sub_id:
          type: string
          description: Provider-scoped sub-tracking identifier.
        source:
          $ref: "#/components/schemas/AffiliateAttributionSource"
        issued_at:
          type: string
          format: date-time
          description: RFC3339 timestamp when the attribution token was issued.
        expires_at:
          type: string
          format: date-time
          description: RFC3339 timestamp when the attribution token expires.
        metadata:
          $ref: "#/components/schemas/AffiliateAttributionMetadata"
        touchpoint:
          type: string
          enum: [first, last]
          description: |
            Attribution touchpoint type. Use 'first' when capturing at session creation,
            'last' when capturing at completion. Enables multi-touch attribution models.
      required: [provider]
      anyOf:
        - required: [token]
        - required: [publisher_id]
      example:
        provider: "impact.com"
        token: "atp_01J8Z3WXYZ9ABC"
        publisher_id: "pub_123"
        campaign_id: "camp_summer2026"
        touchpoint: "first"
        source:
          type: "url"
          url: "https://example.com/product-review"
        issued_at: "2026-02-11T10:00:00Z"
        expires_at: "2026-02-11T11:00:00Z"

    FulfillmentDetails:
      type: object
      additionalProperties: false
      properties:
        name: { type: string, description: "Full name for fulfillment contact" }
        phone_number: { type: string, description: "Contact phone number" }
        email: { type: string, format: email, description: "Contact email address" }
        address: { $ref: "#/components/schemas/Address", description: "Fulfillment address" }
      example:
        name: "John Smith"
        phone_number: "15551234567"
        email: "john.smith@example.com"
        address:
          name: "John Smith"
          line_one: "555 Golden Gate Avenue"
          line_two: "Apt 401"
          city: "San Francisco"
          state: "CA"
          country: "US"
          postal_code: "94102"

    CompanyInfo:
      type: object
      additionalProperties: false
      properties:
        name: { type: string, description: "Company or organization name" }
        tax_id: { type: string, description: "Business tax identification number" }
        department: { type: string, description: "Department within the organization" }
        cost_center: { type: string, description: "Cost center code for internal accounting" }
      required: [name]
      example:
        name: "Acme Corporation"
        tax_id: "12-3456789"
        department: "Marketing"
        cost_center: "CC-2001"

    LoyaltyInfo:
      type: object
      additionalProperties: false
      properties:
        tier: { type: string, description: "Loyalty program tier level" }
        points_balance: { type: integer, description: "Current loyalty points balance" }
        member_since: { type: string, format: date-time, description: "RFC 3339 timestamp when the customer joined the loyalty program" }
      example:
        tier: "Gold"
        points_balance: 5000
        member_since: "2024-01-15T09:00:00Z"

    TaxExemption:
      type: object
      additionalProperties: false
      properties:
        certificate_id: { type: string, description: "Unique identifier for the tax exemption certificate" }
        certificate_type:
          { type: string, enum: [resale, exempt_organization, government], description: "Type of tax exemption certificate" }
        exempt_regions:
          type: array
          items: { type: string }
          description: "List of regions where the exemption applies (e.g., state codes)"
        expires_at: { type: string, format: date-time, description: "RFC 3339 timestamp when the exemption certificate expires" }
      required: [certificate_id, certificate_type]
      example:
        certificate_id: "cert_12345"
        certificate_type: "resale"
        exempt_regions: ["CA", "NY", "TX"]
        expires_at: "2027-12-31T23:59:59Z"

    Buyer:
      type: object
      additionalProperties: false
      properties:
        first_name: { type: string, description: "Buyer's first name" }
        last_name: { type: string, description: "Buyer's last name" }
        full_name: { type: string, description: "Buyer's full name" }
        email: { type: string, format: email, description: "Buyer's email address" }
        phone_number: { type: string, description: "Buyer's phone number" }
        customer_id: { type: string, description: "Merchant's internal customer identifier" }
        account_type: { type: string, enum: [guest, registered, business], description: "Type of buyer account" }
        authentication_status:
          { type: string, enum: [authenticated, guest, requires_signin], description: "Buyer's authentication status" }
        company: { $ref: "#/components/schemas/CompanyInfo", description: "Company information for business buyers" }
        loyalty: { $ref: "#/components/schemas/LoyaltyInfo", description: "Loyalty program information" }
        tax_exemption: { $ref: "#/components/schemas/TaxExemption", description: "Tax exemption details" }
      required: [email]
      example:
        first_name: "Alice"
        last_name: "Johnson"
        email: "alice.johnson@example.com"
        phone_number: "15559876543"
        customer_id: "cust_abc123"
        account_type: "registered"
        authentication_status: "authenticated"

    InterventionCapabilities:
      type: object
      additionalProperties: false
      description: |
        Intervention capabilities.
        Context-specific fields: display_context, redirect_context, max_redirects, max_interaction_depth (requests only).
        required, enforcement (responses only).
        supported field contains intersection in responses.
      properties:
        supported:
          type: array
          items:
            type: string
            enum: [3ds, biometric, address_verification]
          description: |
            Intervention types supported.
            - Agent request: Interventions the agent can handle
            - Seller response: Intersection of supported interventions
        required:
          type: array
          items:
            type: string
            enum: [3ds, biometric]
          description: Intervention methods required for this session (seller only).
        enforcement:
          type: string
          enum: [always, conditional, optional]
          description: When required interventions are enforced (seller only).
        display_context:
          type: string
          enum: [native, webview, modal, redirect]
          description: How the Agent presents interventions (agent only).
        redirect_context:
          type: string
          enum: [in_app, external_browser, none]
          description: How the Agent handles redirects (agent only).
        max_redirects:
          type: integer
          minimum: 0
          description: Maximum number of redirects the Agent can handle (agent only).
        max_interaction_depth:
          type: integer
          minimum: 1
          description: Maximum depth of nested interactions the Agent can handle (agent only).
      example:
        supported: ["3ds", "address_verification"]
        display_context: "webview"
        redirect_context: "in_app"
        max_redirects: 3
        max_interaction_depth: 2

    Capabilities:
      type: object
      additionalProperties: false
      description: |
        Capabilities object used in requests and responses.
        Context determines the party: requests are from Agents, responses are from Sellers.
        Seller responses contain the intersection of supported interventions.
      properties:
        payment:
          $ref: "#/components/schemas/Payment"
        interventions:
          $ref: "#/components/schemas/InterventionCapabilities"
        extensions:
          oneOf:
            - type: array
              items:
                type: string
              uniqueItems: true
              description: Extensions the agent understands (request). Simple identifiers like 'discount'.
            - type: array
              items:
                $ref: "#/components/schemas/ExtensionDeclaration"
              uniqueItems: true
              description: Active extensions for this session (response). Objects with name, extends, schema, spec.
          description: |
            Extensions supported by the party.
            Requests: array of extension identifiers.
            Responses: array of extension declaration objects.
      example:
        payment:
          handlers:
            - id: "handler_1"
              name: "dev.acp.tokenized.card"
              version: "2026-01-30"
              spec: "https://example.com/handler-spec"
              requires_delegate_payment: true
              requires_pci_compliance: false
              psp: "stripe"
              config_schema: "https://example.com/config-schema"
              instrument_schemas: ["https://example.com/instrument-schema"]
              config: {}
        interventions:
          supported: ["3ds"]
        extensions: ["discount"]

    ExtensionDeclaration:
      type: object
      additionalProperties: false
      description: Extension declaration in capabilities.extensions (response). Describes an active extension and which schema fields it adds.
      required: [name]
      properties:
        name:
          type: string
          pattern: '^[a-z][a-z0-9_-]*(@\d{4}-\d{2}-\d{2})?$|^[a-z][a-z0-9]*(?:\.[a-z][a-z0-9_-]*)+(@\d{4}-\d{2}-\d{2})?$'
          description: Unique identifier for the extension.
        extends:
          type: array
          items:
            type: string
            pattern: '^\$\.[A-Za-z][A-Za-z0-9]*(\.[A-Za-z][A-Za-z0-9_]*)*$'
          uniqueItems: true
          description: |
            JSONPath expressions identifying the schema fields added by this extension.
            Format: $.<SchemaName>.<fieldName> (e.g., $.CheckoutSession.discounts).
        schema:
          type: string
          format: uri
          description: URL to the extension's JSON Schema definition.
        spec:
          type: string
          format: uri
          description: URL to the extension's specification document.
      example:
        name: "discount@2026-01-30"
        extends: ["$.CheckoutSession.discounts", "$.CheckoutSessionCreateRequest.discounts"]
        schema: "https://example.com/extensions/discount/schema.json"
        spec: "https://example.com/extensions/discount/spec"

    PaymentMethodObject:
      type: object
      additionalProperties: false
      description: Payment method with additional constraints (e.g., card brands, PSP routing)
      properties:
        method:
          type: string
          description: The payment method identifier
        brands:
          type: array
          items:
            type: string
            enum: [visa, mastercard, amex, discover, diners, jcb, unionpay, eftpos, interac]
          description: Specific card brands/networks accepted
        funding_types:
          type: array
          items:
            type: string
            enum: [credit, debit, prepaid]
          description: For card methods, funding types accepted
        providers:
          type: array
          items:
            type: string
          description: Optional PSP routing information
      required: [method]
      example:
        method: "card"
        brands: ["visa", "mastercard", "amex"]
        funding_types: ["credit", "debit"]
        providers: ["stripe"]

    Item:
      type: object
      additionalProperties: false
      properties:
        id: { type: string, description: "Unique identifier for the item" }
        name: { type: string, description: "Display name of the item" }
        unit_amount: { type: integer, description: "Price per unit in minor currency units (e.g. 100 cents for $1.00 or 100 for ¥100)" }
      required: [id]
      example:
        id: "item_123"
        name: "Wireless Headphones"
        unit_amount: 7999

    Disclosure:
      type: object
      additionalProperties: false
      properties:
        type: { type: string, enum: [disclaimer], description: "Type of disclosure" }
        content_type: { type: string, enum: [plain, markdown], description: "Format of the disclosure content" }
        content: { type: string, description: "The disclosure text content" }
      required: [type, content_type, content]
      example:
        type: "disclaimer"
        content_type: "plain"
        content: "This product contains small parts and is not suitable for children under 3 years."

    CustomAttribute:
      type: object
      additionalProperties: false
      properties:
        display_name: { type: string, description: "Human-readable label for the attribute" }
        value: { type: string, description: "Attribute value" }
      required: [display_name, value]
      example:
        display_name: "Engraving"
        value: "Happy Birthday!"

    MarketplaceSellerDetails:
      type: object
      additionalProperties: false
      properties:
        name: { type: string, description: "Name of the marketplace seller or vendor" }
      required: [name]
      example:
        name: "TechGear Store"

    PaymentHandler:
      type: object
      additionalProperties: false
      description: Payment handler configuration and capabilities
      properties:
        id:
          type: string
          description: Seller-defined handler identifier
        name:
          type: string
          description: Handler name in reverse-DNS format (e.g., dev.acp.tokenized.card)
        version:
          type: string
          pattern: '^\d{4}-\d{2}-\d{2}$'
          description: Handler version in YYYY-MM-DD format
        spec:
          type: string
          format: uri
          description: URL to handler specification
        requires_delegate_payment:
          type: boolean
          description: Whether this handler requires using delegate_payment API
        requires_pci_compliance:
          type: boolean
          description: Whether this handler routes PCI DSS sensitive data
        psp:
          type: string
          description: Payment Service Provider identifier
        config_schema:
          type: string
          format: uri
          description: URL to JSON Schema for handler configuration
        instrument_schemas:
          type: array
          items:
            type: string
            format: uri
          description: URLs to JSON Schemas for payment instruments
        config:
          type: object
          description: Handler-specific configuration
      required: [id, name, version, spec, requires_delegate_payment, requires_pci_compliance, psp, config_schema, instrument_schemas, config]
      example:
        id: "handler_stripe_card"
        name: "dev.acp.tokenized.card"
        version: "2026-01-30"
        spec: "https://example.com/payment-handlers/tokenized-card"
        requires_delegate_payment: true
        requires_pci_compliance: false
        psp: "stripe"
        config_schema: "https://example.com/schemas/card-config.json"
        instrument_schemas: ["https://example.com/schemas/card-instrument.json"]
        config:
          publishable_key: "pk_test_123"

    Payment:
      type: object
      additionalProperties: false
      description: Payment configuration with handlers
      properties:
        handlers:
          type: array
          items:
            $ref: "#/components/schemas/PaymentHandler"
          description: Available payment handlers
      required: [handlers]
      example:
        handlers:
          - id: "handler_stripe_card"
            name: "dev.acp.tokenized.card"
            version: "2026-01-30"
            spec: "https://example.com/payment-handlers/tokenized-card"
            requires_delegate_payment: true
            requires_pci_compliance: false
            psp: "stripe"
            config_schema: "https://example.com/schemas/card-config.json"
            instrument_schemas: ["https://example.com/schemas/card-instrument.json"]
            config:
              publishable_key: "pk_test_123"

    VariantOption:
      type: object
      additionalProperties: false
      properties:
        name: { type: string, description: "Variant attribute name (e.g., 'Size', 'Color')" }
        value: { type: string, description: "Variant attribute value (e.g., 'Large', 'Blue')" }
      required: [name, value]
      example:
        name: "Color"
        value: "Midnight Blue"

    WeightInfo:
      type: object
      additionalProperties: false
      properties:
        value: { type: number, description: "Numeric weight value" }
        unit: { type: string, enum: [g, kg, oz, lb], description: "Unit of measurement for weight" }
      required: [value, unit]
      example:
        value: 250
        unit: "g"

    DimensionsInfo:
      type: object
      additionalProperties: false
      properties:
        length: { type: number, description: "Length dimension" }
        width: { type: number, description: "Width dimension" }
        height: { type: number, description: "Height dimension" }
        unit: { type: string, enum: [cm, in], description: "Unit of measurement for dimensions" }
      required: [length, width, height, unit]
      example:
        length: 15.5
        width: 10.2
        height: 5.8
        unit: "cm"

    DiscountDetail:
      type: object
      additionalProperties: false
      properties:
        code: { type: string, description: "Discount code if applicable" }
        type: { type: string, enum: [percentage, fixed, bogo, volume], description: "Type of discount" }
        amount: { type: integer, description: "Discount amount in minor currency units (e.g. 100 cents for $1.00 or 100 for ¥100)" }
        description: { type: string, description: "Human-readable discount description" }
        source: { type: string, enum: [coupon, automatic, loyalty], description: "Source of the discount" }
      required: [type, amount]
      example:
        code: "SAVE20"
        type: "percentage"
        amount: 1600
        description: "20% off your order"
        source: "coupon"

    LineItem:
      type: object
      additionalProperties: false
      properties:
        id: { type: string, description: "Unique identifier for the line item" }
        item: { $ref: "#/components/schemas/Item", description: "Reference to the item being purchased" }
        quantity: { type: integer, minimum: 1, description: "Number of units for this line item" }
        name: { type: string, description: "Display name of the line item" }
        description: { type: string, description: "Detailed description of the line item" }
        images:
          type: array
          items: { type: string, format: uri }
          description: "Array of image URLs for this line item"
        unit_amount: { type: integer, description: "Price per unit in minor currency units (e.g. 100 cents for $1.00 or 100 for ¥100)" }
        disclosures:
          type: array
          items: { $ref: "#/components/schemas/Disclosure" }
          description: "Legal disclosures or disclaimers for this item"
        custom_attributes:
          type: array
          items: { $ref: "#/components/schemas/CustomAttribute" }
          description: "Custom attributes specific to this line item"
        marketplace_seller_details:
          { $ref: "#/components/schemas/MarketplaceSellerDetails", description: "Seller details for marketplace items" }
        product_id: { type: string, description: "Merchant's product identifier" }
        sku: { type: string, description: "Stock keeping unit identifier" }
        variant_id: { type: string, description: "Product variant identifier" }
        category: { type: string, description: "Product category" }
        tags:
          type: array
          items: { type: string }
          description: "Product tags or labels"
        weight: { $ref: "#/components/schemas/WeightInfo", description: "Weight information for the item" }
        dimensions: { $ref: "#/components/schemas/DimensionsInfo", description: "Dimensions for the item" }
        availability_status:
          {
            type: string,
            enum: [in_stock, low_stock, out_of_stock, backorder, pre_order],
            description: "Current availability status of the item"
          }
        available_quantity: { type: integer, minimum: 0, description: "Quantity currently available for purchase" }
        max_quantity_per_order: { type: integer, minimum: 1, description: "Maximum quantity allowed per order" }
        fulfillable_on: { type: string, format: date-time, description: "RFC 3339 timestamp when item becomes available for fulfillment" }
        variant_options:
          type: array
          items: { $ref: "#/components/schemas/VariantOption" }
          description: "Selected product variant options (e.g., size, color)"
        discount_details:
          type: array
          items: { $ref: "#/components/schemas/DiscountDetail" }
          description: "Line-item level discount details"
        tax_exempt: { type: boolean, description: "Whether this line item is tax exempt" }
        tax_exemption_reason: { type: string, description: "Reason for tax exemption if applicable" }
        parent_id: { type: string, description: "Reference to parent line item for bundled products" }
        totals:
          type: array
          items: { $ref: "#/components/schemas/Total" }
          description: "Line-item level totals breakdown including base_amount, discount, subtotal, tax, and total"
      required: [id, item, quantity, totals]
      example:
        id: "li_001"
        item:
          id: "item_123"
          name: "Wireless Headphones"
          unit_amount: 7999
        quantity: 2
        name: "Premium Wireless Headphones"
        unit_amount: 7999
        availability_status: "in_stock"
        totals:
          - type: "subtotal"
            display_text: "Subtotal"
            amount: 15998

    TaxBreakdownItem:
      type: object
      additionalProperties: false
      properties:
        jurisdiction: { type: string, description: "Tax jurisdiction name (e.g., 'California State Tax', 'City of San Francisco')" }
        rate: { type: number, description: "Tax rate as a decimal (e.g., 0.0875 for 8.75%)" }
        amount: { type: integer, description: "Tax amount in minor currency units (e.g. 100 cents for $1.00 or 100 for ¥100)" }
      required: [jurisdiction, rate, amount]
      example:
        jurisdiction: "California State Tax"
        rate: 0.0725
        amount: 1160

    Total:
      type: object
      additionalProperties: false
      properties:
        type:
          type: string
          enum:
            [
              items_base_amount,
              items_discount,
              subtotal,
              discount,
              fulfillment,
              tax,
              fee,
              gift_wrap,
              tip,
              store_credit,
              total,
            ]
          description: "Type of total line item"
        display_text: { type: string, description: "Localized display text for this total" }
        amount: { type: integer, description: "Amount in minor currency units (e.g. 100 cents for $1.00 or 100 for ¥100)" }
        presentment_amount: { type: integer, description: "Amount in presentment currency minor units if different from settlement currency" }
        description: { type: string, description: "Additional descriptive text for this total" }
        breakdown:
          type: array
          items: { $ref: "#/components/schemas/TaxBreakdownItem" }
          description: "Detailed breakdown for tax totals"
      required: [type, display_text, amount]
      example:
        type: "tax"
        display_text: "Sales Tax"
        amount: 1400
        breakdown:
          - jurisdiction: "California State Tax"
            rate: 0.0725
            amount: 1160
          - jurisdiction: "San Francisco County Tax"
            rate: 0.015
            amount: 240

    FulfillmentOptionPickup:
      type: object
      additionalProperties: false
      properties:
        type: { type: string, const: pickup, description: "Fulfillment type discriminator" }
        id: { type: string, description: "Unique identifier for this fulfillment option" }
        title: { type: string, description: "Display title for this pickup option" }
        description: { type: string, description: "Additional details about this pickup option" }
        location:
          type: object
          description: "Pickup location details"
          properties:
            name: { type: string, description: "Location name" }
            address: { $ref: "#/components/schemas/Address", description: "Pickup address" }
            phone: { type: string, description: "Location phone number" }
            instructions: { type: string, description: "Special pickup instructions" }
          required: [name, address]
        pickup_type: { type: string, enum: [in_store, curbside, locker], description: "Type of pickup method" }
        ready_by: { type: string, format: date-time, description: "RFC 3339 timestamp when order will be ready for pickup" }
        pickup_by: { type: string, format: date-time, description: "RFC 3339 timestamp by which order must be picked up" }
        totals:
          type: array
          items: { $ref: "#/components/schemas/Total" }
          description: "Cost breakdown for this fulfillment option"
      required: [type, id, title, location, totals]
      example:
        type: "pickup"
        id: "pickup_001"
        title: "In-Store Pickup"
        description: "Pick up at our downtown location"
        location:
          name: "Downtown Store"
          address:
            name: "Downtown Store"
            line_one: "100 Market Street"
            city: "San Francisco"
            state: "CA"
            country: "US"
            postal_code: "94105"
          phone: "14155551234"
          instructions: "Use the pickup counter on the first floor"
        pickup_type: "in_store"
        ready_by: "2026-02-12T15:00:00Z"
        totals:
          - type: "fulfillment"
            display_text: "Pickup"
            amount: 0

    FulfillmentOptionLocalDelivery:
      type: object
      additionalProperties: false
      properties:
        type: { type: string, const: local_delivery, description: "Fulfillment type discriminator" }
        id: { type: string, description: "Unique identifier for this fulfillment option" }
        title: { type: string, description: "Display title for this local delivery option" }
        description: { type: string, description: "Additional details about this delivery option" }
        delivery_window:
          type: object
          description: "Expected delivery time window"
          properties:
            start: { type: string, format: date-time, description: "RFC 3339 timestamp for delivery window start" }
            end: { type: string, format: date-time, description: "RFC 3339 timestamp for delivery window end" }
          required: [start, end]
        service_area:
          type: object
          description: "Geographic service area for local delivery"
          properties:
            radius_miles: { type: number, description: "Delivery radius in miles" }
            center_postal_code: { type: string, description: "Center point postal code for delivery radius" }
        totals:
          type: array
          items: { $ref: "#/components/schemas/Total" }
          description: "Cost breakdown for this fulfillment option"
      required: [type, id, title, totals]
      example:
        type: "local_delivery"
        id: "local_001"
        title: "Same-Day Local Delivery"
        description: "Delivered by our team today"
        delivery_window:
          start: "2026-02-11T16:00:00Z"
          end: "2026-02-11T20:00:00Z"
        service_area:
          radius_miles: 10
          center_postal_code: "94102"
        totals:
          - type: "fulfillment"
            display_text: "Delivery Fee"
            amount: 999

    FulfillmentOptionShipping:
      type: object
      additionalProperties: false
      properties:
        type: { type: string, const: shipping, description: "Fulfillment type discriminator" }
        id: { type: string, description: "Unique identifier for this fulfillment option" }
        title: { type: string, description: "Display title for this shipping option (e.g., 'Standard Shipping', 'Express')" }
        description: { type: string, description: "Additional details about this shipping option" }
        carrier: { type: string, description: "Shipping carrier name (e.g., 'USPS', 'FedEx')" }
        earliest_delivery_time: { type: string, format: date-time, description: "RFC 3339 timestamp for earliest expected delivery" }
        latest_delivery_time: { type: string, format: date-time, description: "RFC 3339 timestamp for latest expected delivery" }
        totals:
          type: array
          items: { $ref: "#/components/schemas/Total" }
          description: "Cost breakdown for this fulfillment option"
      required: [type, id, title, totals]
      example:
        type: "shipping"
        id: "ship_standard"
        title: "Standard Shipping"
        description: "Delivery in 5-7 business days"
        carrier: "USPS"
        earliest_delivery_time: "2026-02-16T00:00:00Z"
        latest_delivery_time: "2026-02-20T23:59:59Z"
        totals:
          - type: "fulfillment"
            display_text: "Shipping"
            amount: 599

    FulfillmentOptionDigital:
      type: object
      additionalProperties: false
      properties:
        type: { type: string, const: digital, description: "Fulfillment type discriminator" }
        id: { type: string, description: "Unique identifier for this fulfillment option" }
        title: { type: string, description: "Display title for this digital delivery option" }
        description: { type: string, description: "Additional details about digital delivery method" }
        totals:
          type: array
          items: { $ref: "#/components/schemas/Total" }
          description: "Cost breakdown for this fulfillment option"
      required: [type, id, title, totals]
      example:
        type: "digital"
        id: "digital_001"
        title: "Instant Download"
        description: "Available immediately after purchase"
        totals:
          - type: "fulfillment"
            display_text: "Digital Delivery"
            amount: 0

    SelectedFulfillmentOption:
      type: object
      additionalProperties: false
      properties:
        type: { type: string, enum: [shipping, digital, pickup, local_delivery], description: "Type of fulfillment option selected" }
        option_id: { type: string, description: "ID of the selected fulfillment option" }
        item_ids:
          type: array
          items: { type: string }
          description: "List of line item IDs associated with this fulfillment option"
      required: [type, option_id, item_ids]
      example:
        type: "shipping"
        option_id: "ship_standard"
        item_ids: ["li_001", "li_002"]

    MessageInfo:
      type: object
      additionalProperties: false
      properties:
        type: { type: string, const: info, description: "Message type discriminator" }
        severity: { type: string, enum: [info, low, medium, high, critical], description: "Severity level of this informational message" }
        param: { type: string, description: "RFC 9535 JSONPath to the related field" }
        content_type: { type: string, enum: [plain, markdown], description: "Format of the message content" }
        content: { type: string, description: "Informational message text" }
      required: [type, content_type, content]
      example:
        type: "info"
        severity: "info"
        content_type: "plain"
        content: "Free shipping on orders over $50"

    MessageWarning:
      type: object
      additionalProperties: false
      properties:
        type: { type: string, const: warning, description: "Message type discriminator" }
        code:
          {
            type: string,
            enum:
              [
                low_stock,
                high_demand,
                shipping_delay,
                price_change,
                expiring_promotion,
                limited_availability,
                discount_code_expired,
                discount_code_invalid,
                discount_code_already_applied,
                discount_code_combination_disallowed,
                discount_code_minimum_not_met,
                discount_code_user_not_logged_in,
                discount_code_user_ineligible,
                discount_code_usage_limit_reached,
              ],
            description: "Warning code indicating the type of warning"
          }
        severity: { type: string, enum: [info, low, medium, high, critical], description: "Severity level of this warning" }
        param: { type: string, description: "RFC 9535 JSONPath to the related field" }
        content_type: { type: string, enum: [plain, markdown], description: "Format of the warning message content" }
        content: { type: string, description: "Warning message text" }
      required: [type, code, content_type, content]
      example:
        type: "warning"
        code: "low_stock"
        severity: "medium"
        param: "$.line_items[0]"
        content_type: "plain"
        content: "Only 3 items left in stock"

    MessageError:
      type: object
      additionalProperties: false
      description: |
        Business-logic error within a valid CheckoutSession response. Used in messages[]
        on 2xx responses when the session is valid but has actionable issues (e.g.
        status "not_ready_for_payment"). The agent can respond by asking the buyer
        for corrections or trying alternatives. Use MessageError—not Error—when you
        can return a valid CheckoutSession and the problem is conversational (e.g.
        invalid email → code "invalid" and param "$.buyer.email"; out of stock →
        code "out_of_stock" and param "$.items[0]").
      properties:
        type: { type: string, const: error, description: "Message type discriminator" }
        code:
          {
            type: string,
            enum:
              [
                missing,
                invalid,
                out_of_stock,
                payment_declined,
                requires_sign_in,
                requires_3ds,
                low_stock,
                quantity_exceeded,
                coupon_invalid,
                coupon_expired,
                minimum_not_met,
                maximum_exceeded,
                region_restricted,
                age_verification_required,
                approval_required,
                unsupported,
                not_found,
                conflict,
                rate_limited,
                expired,
                intervention_required,
              ],
            description: "Error code indicating the type of error"
          }
        severity: { type: string, enum: [info, low, medium, high, critical], description: "Severity level of this error" }
        param:
          { type: string, description: "RFC 9535 JSONPath", nullable: true }
        content_type: { type: string, enum: [plain, markdown], description: "Format of the error message content" }
        content: { type: string, description: "Error message text" }
      required: [type, code, content_type, content]
      example:
        type: "error"
        code: "out_of_stock"
        severity: "medium"
        param: "$.line_items[0]"
        content_type: "plain"
        content: "The item is out of stock"

    GiftWrap:
      type: object
      additionalProperties: false
      properties:
        enabled: { type: boolean, description: "Whether gift wrapping is enabled for this order" }
        style: { type: string, enum: [birthday, holiday, elegant], description: "Gift wrap style selected" }
        charge: { type: integer, description: "Additional charge for gift wrapping in minor currency units (e.g. 100 cents for $1.00 or 100 for ¥100)" }
      required: [enabled]
      example:
        enabled: true
        style: "elegant"
        charge: 500

    Link:
      type: object
      additionalProperties: false
      properties:
        type:
          {
            type: string,
            enum:
              [
                terms_of_use,
                privacy_policy,
                return_policy,
                shipping_policy,
                contact_us,
                about_us,
                faq,
                support,
              ],
            description: "Type of link"
          }
        title: { type: string, description: "Display text for the link" }
        url: { type: string, format: uri, description: "URL destination" }
      required: [type, url]
      example:
        type: "return_policy"
        title: "Return Policy"
        url: "https://example.com/returns"

    SplitPayment:
      type: object
      additionalProperties: false
      properties:
        amount: { type: integer, description: "Payment amount in minor currency units (e.g. 100 cents for $1.00 or 100 for ¥100) for this split" }
      required: [amount]
      example:
        amount: 5000

    PaymentData:
      type: object
      additionalProperties: false
      properties:
        handler_id:
          type: string
          description: ID of the payment handler to use
        instrument:
          type: object
          description: Payment instrument details
          properties:
            type:
              type: string
              description: Instrument type (e.g., card, wallet_token)
            credential:
              type: object
              description: Payment credential
              properties:
                type:
                  type: string
                  description: Credential type (e.g., spt, wallet_token)
                token:
                  type: string
                  description: Credential token value
              required: [type, token]
          required: [type, credential]
        billing_address: { $ref: "#/components/schemas/Address", description: "Billing address for the payment" }
        purchase_order_number: { type: string, description: "Purchase order number" }
        payment_terms:
          { type: string, enum: [immediate, net_15, net_30, net_60, net_90], description: "Payment terms for B2B transactions" }
        due_date: { type: string, format: date-time, description: "RFC 3339 timestamp when payment is due" }
        approval_required: { type: boolean, description: "Whether this payment requires approval" }
      anyOf:
        - required: [handler_id, instrument]
        - required: [purchase_order_number]
      example:
        handler_id: "handler_stripe_card"
        instrument:
          type: "card"
          credential:
            type: "spt"
            token: "spt_1234567890"
        billing_address:
          name: "John Smith"
          line_one: "123 Main Street"
          city: "New York"
          state: "NY"
          country: "US"
          postal_code: "10001"

    FulfillmentGroup:
      type: object
      additionalProperties: false
      properties:
        id: { type: string, description: "Unique identifier for this fulfillment group" }
        item_ids:
          type: array
          items: { type: string }
          description: "List of line item IDs in this fulfillment group"
        destination_type:
          {
            type: string,
            enum: [shipping, pickup, local_delivery, digital],
            description: "Type of fulfillment for this group"
          }
        fulfillment_details: { $ref: "#/components/schemas/FulfillmentDetails", description: "Fulfillment contact and address details" }
        location_id: { type: string, description: "Location identifier for pickup or local delivery" }
        instructions: { type: string, description: "Special fulfillment instructions" }
      required: [id, item_ids, destination_type]
      example:
        id: "fg_001"
        item_ids: ["li_001", "li_002"]
        destination_type: "shipping"
        instructions: "Leave package at front door"

    EstimatedDelivery:
      type: object
      additionalProperties: false
      properties:
        earliest: { type: string, format: date-time, description: "RFC 3339 timestamp for earliest expected delivery" }
        latest: { type: string, format: date-time, description: "RFC 3339 timestamp for latest expected delivery" }
      required: [earliest, latest]
      example:
        earliest: "2026-02-14T00:00:00Z"
        latest: "2026-02-18T23:59:59Z"

    OrderConfirmation:
      type: object
      additionalProperties: false
      properties:
        confirmation_number: { type: string, description: "Order confirmation number" }
        confirmation_email_sent: { type: boolean, description: "Whether a confirmation email has been sent" }
        receipt_url: { type: string, format: uri, description: "URL to the order receipt" }
        invoice_number: { type: string, description: "Invoice number if generated" }
      example:
        confirmation_number: "ORD-2026-02-11-001"
        confirmation_email_sent: true
        receipt_url: "https://example.com/receipts/ord_123"
        invoice_number: "INV-2026-001"

    SupportInfo:
      type: object
      additionalProperties: false
      properties:
        email: { type: string, format: email, description: "Support contact email" }
        phone: { type: string, description: "Support contact phone number" }
        hours: { type: string, description: "Support hours of operation" }
        help_center_url: { type: string, format: uri, description: "URL to merchant's help center" }
      example:
        email: "support@example.com"
        phone: "18005551234"
        hours: "Mon-Fri 9am-5pm PST"
        help_center_url: "https://example.com/help"

    Order:
      type: object
      additionalProperties: false
      properties:
        id: { type: string, description: "Unique identifier for the order" }
        checkout_session_id: { type: string, description: "ID of the checkout session that created this order" }
        order_number: { type: string, description: "Human-readable order number" }
        permalink_url: { type: string, format: uri, description: "Permanent URL where the customer can view order details" }
        status: { type: string, enum: [confirmed, processing, shipped, delivered], description: "Current order status" }
        estimated_delivery: { $ref: "#/components/schemas/EstimatedDelivery", description: "Estimated delivery time range" }
        confirmation: { $ref: "#/components/schemas/OrderConfirmation", description: "Order confirmation details" }
        support: { $ref: "#/components/schemas/SupportInfo", description: "Customer support contact information" }
      required: [id, checkout_session_id, permalink_url]
      example:
        id: "ord_123456"
        checkout_session_id: "cs_abc123"
        order_number: "ORD-2026-001"
        permalink_url: "https://example.com/orders/ord_123456"
        status: "confirmed"
        estimated_delivery:
          earliest: "2026-02-14T00:00:00Z"
          latest: "2026-02-18T23:59:59Z"
        confirmation:
          confirmation_number: "ORD-2026-02-11-001"
          confirmation_email_sent: true
          receipt_url: "https://example.com/receipts/ord_123456"

    ProtocolVersion:
      type: object
      additionalProperties: false
      description: Protocol metadata included in checkout responses. Indicates the ACP version.
      properties:
        version:
          type: string
          pattern: '^\d{4}-\d{2}-\d{2}$'
          example: "2026-01-30"
          description: ACP protocol version in YYYY-MM-DD format.
      required: [version]
      example:
        version: "2026-01-30"

    DiscountAllocation:
      type: object
      additionalProperties: false
      description: Breakdown of how a discount amount was allocated to a specific target.
      required: [path, amount]
      properties:
        path:
          type: string
          description: "JSONPath to the allocation target (e.g., '$.line_items[0]', '$.totals.shipping')."
        amount:
          type: integer
          minimum: 0
          description: Amount allocated to this target in minor (cents) currency units.
      example:
        path: "$.line_items[0]"
        amount: 500

    Coupon:
      type: object
      additionalProperties: false
      description: Coupon details describing the discount terms.
      required: [id, name]
      properties:
        id:
          type: string
          description: Unique identifier for the coupon.
        name:
          type: string
          description: "Human-readable coupon name (e.g., 'Summer Sale 20% Off')."
        percent_off:
          type: number
          minimum: 0
          maximum: 100
          description: Percentage discount (0-100). Mutually exclusive with amount_off.
        amount_off:
          type: integer
          minimum: 0
          description: Fixed discount amount in minor currency units. Mutually exclusive with percent_off.
        currency:
          type: string
          pattern: '^[a-z]{3}$'
          description: ISO 4217 currency code for amount_off. Required if amount_off is set.
        duration:
          type: string
          enum: [once, repeating, forever]
          description: "How long the discount applies. 'once' = single use, 'repeating' = multiple billing periods, 'forever' = indefinitely."
        duration_in_months:
          type: integer
          minimum: 1
          description: "Number of months the coupon applies if duration is 'repeating'."
        max_redemptions:
          type: integer
          minimum: 1
          description: Maximum number of times this coupon can be redeemed across all customers.
        times_redeemed:
          type: integer
          minimum: 0
          description: Number of times this coupon has been redeemed.
        metadata:
          type: object
          additionalProperties: { type: string }
          description: Arbitrary key-value metadata attached to the coupon.
      example:
        id: "coupon_summer2026"
        name: "Summer Sale 20% Off"
        percent_off: 20
        duration: "once"
        max_redemptions: 1000
        times_redeemed: 145

    AppliedDiscount:
      type: object
      additionalProperties: false
      description: A discount that was successfully applied to the checkout session.
      required: [id, coupon, amount]
      properties:
        id:
          type: string
          description: Unique identifier for this applied discount instance.
        code:
          type: string
          description: The discount code entered by the user. Omitted for automatic discounts.
        coupon:
          $ref: "#/components/schemas/Coupon"
        amount:
          type: integer
          minimum: 0
          description: Total discount amount in minor (cents) currency units.
        automatic:
          type: boolean
          default: false
          description: True if applied automatically by merchant rules (no code required).
        start:
          type: string
          format: date-time
          description: RFC 3339 timestamp when the discount became active.
        end:
          type: string
          format: date-time
          description: RFC 3339 timestamp when the discount expires.
        method:
          type: string
          enum: [each, across]
          description: "Allocation method. 'each' = applied independently per item. 'across' = split proportionally by value."
        priority:
          type: integer
          minimum: 1
          description: Stacking order for discount calculation. Lower numbers applied first (1 = first).
        allocations:
          type: array
          items: { $ref: "#/components/schemas/DiscountAllocation" }
          description: Breakdown of where this discount was allocated. Sum of allocation amounts equals total amount.
      example:
        id: "applied_discount_001"
        code: "SAVE20"
        coupon:
          id: "coupon_summer2026"
          name: "Summer Sale 20% Off"
          percent_off: 20
          duration: "once"
        amount: 1600
        automatic: false
        method: "across"
        priority: 1
        allocations:
          - path: "$.line_items[0]"
            amount: 1600

    RejectedDiscount:
      type: object
      additionalProperties: false
      description: A discount code that could not be applied, with the reason.
      required: [code, reason]
      properties:
        code: { type: string, description: "The discount code that was rejected." }
        reason: { $ref: "#/components/schemas/DiscountErrorCode", description: "Error code indicating why the discount was rejected." }
        message: { type: string, description: "Human-readable explanation of why the code was rejected." }
      example:
        code: "EXPIRED10"
        reason: "discount_code_expired"
        message: "This discount code expired on January 31, 2026"

    DiscountErrorCode:
      type: string
      enum: [discount_code_expired, discount_code_invalid, discount_code_already_applied, discount_code_combination_disallowed, discount_code_minimum_not_met, discount_code_user_not_logged_in, discount_code_user_ineligible, discount_code_usage_limit_reached]
      description: Error codes for rejected discount codes, used in messages[].code.
      example: "discount_code_expired"

    DiscountsRequest:
      type: object
      additionalProperties: false
      description: Discount codes input for checkout create/update requests.
      properties:
        codes:
          type: array
          items: { type: string }
          description: Discount codes to apply. Case-insensitive. Replaces previously submitted codes. Send empty array to clear.
      example:
        codes: ["SAVE20", "FREESHIP"]

    DiscountsResponse:
      type: object
      additionalProperties: false
      description: Discount codes input and applied discounts output in checkout responses.
      properties:
        codes:
          type: array
          items: { type: string }
          description: Echo of submitted discount codes.
        applied:
          type: array
          items: { $ref: "#/components/schemas/AppliedDiscount" }
          description: Discounts successfully applied (code-based and automatic).
        rejected:
          type: array
          items: { $ref: "#/components/schemas/RejectedDiscount" }
          description: Discount codes that could not be applied, with reasons.
      example:
        codes: ["SAVE20"]
        applied:
          - id: "applied_discount_001"
            code: "SAVE20"
            coupon:
              id: "coupon_summer2026"
              name: "Summer Sale 20% Off"
              percent_off: 20
              duration: "once"
            amount: 1600
            automatic: false
            method: "across"
        rejected: []

    PaymentResponse:
      type: object
      additionalProperties: false
      properties:
        provider: { type: string, description: "Payment provider identifier" }
        instruments:
          type: array
          items:
            type: object
            additionalProperties: true
          description: "Available payment instruments"
        handlers:
          type: array
          items:
            type: object
            additionalProperties: true
          description: "Available payment handlers"
      example:
        provider: "stripe"
        instruments: []
        handlers: []

    CheckoutSessionBase:
      type: object
      additionalProperties: false
      properties:
        id: { type: string, description: "Unique identifier for the checkout session" }
        protocol: { $ref: "#/components/schemas/ProtocolVersion", description: "Protocol version metadata" }
        capabilities: { $ref: "#/components/schemas/Capabilities", description: "Negotiated capabilities between agent and seller" }
        buyer: { $ref: "#/components/schemas/Buyer", description: "Buyer information" }
        status:
          {
            type: string,
            enum:
              [
                incomplete,
                not_ready_for_payment,
                requires_escalation,
                authentication_required,
                ready_for_payment,
                pending_approval,
                complete_in_progress,
                completed,
                canceled,
                in_progress,
                expired,
              ],
            description: "Current status of the checkout session"
          }
        currency: { type: string, description: "ISO 4217 settlement currency code" }
        presentment_currency: { type: string, description: "ISO 4217 presentment currency code if different from settlement currency" }
        exchange_rate: { type: number, description: "Exchange rate from presentment to settlement currency" }
        exchange_rate_timestamp: { type: string, format: date-time, description: "RFC 3339 timestamp when exchange rate was determined" }
        locale: { type: string, description: "Locale code (e.g., 'en-US') for localizing content" }
        timezone: { type: string, description: "IANA timezone identifier (e.g., 'America/New_York')" }
        line_items:
          type: array
          items: { $ref: "#/components/schemas/LineItem" }
          description: "Line items in the checkout session"
        fulfillment_details: { $ref: "#/components/schemas/FulfillmentDetails", description: "Fulfillment contact and address details" }
        fulfillment_options:
          type: array
          items:
            oneOf:
              - $ref: "#/components/schemas/FulfillmentOptionShipping"
              - $ref: "#/components/schemas/FulfillmentOptionDigital"
              - $ref: "#/components/schemas/FulfillmentOptionPickup"
              - $ref: "#/components/schemas/FulfillmentOptionLocalDelivery"
          description: "Available fulfillment options"
        selected_fulfillment_options:
          type: array
          items: { $ref: "#/components/schemas/SelectedFulfillmentOption" }
          description: "Currently selected fulfillment options"
        fulfillment_groups:
          type: array
          items: { $ref: "#/components/schemas/FulfillmentGroup" }
          description: "Grouping of line items by fulfillment method"
        totals:
          type: array
          items: { $ref: "#/components/schemas/Total" }
          description: "Cart-level totals breakdown"
        messages:
          type: array
          items:
            oneOf:
              - $ref: "#/components/schemas/MessageInfo"
              - $ref: "#/components/schemas/MessageWarning"
              - $ref: "#/components/schemas/MessageError"
          description: "Messages to communicate with the buyer (info, warnings, errors)"
        links:
          type: array
          items: { $ref: "#/components/schemas/Link" }
          description: "Relevant links (terms, policies, support)"
        authentication_metadata:
          $ref: "#/components/schemas/AuthenticationMetadata"
          description: "Authentication metadata for payment interventions (e.g., 3DS)"
        created_at: { type: string, format: date-time, description: "RFC 3339 timestamp when the session was created" }
        updated_at: { type: string, format: date-time, description: "RFC 3339 timestamp of last update" }
        expires_at: { type: string, format: date-time, description: "RFC 3339 timestamp when the session expires" }
        continue_url: { type: string, format: uri, description: "URL to continue or resume the checkout session" }
        metadata:
          type: object
          additionalProperties: true
          description: "Arbitrary metadata for merchant use"
        quote_id: { type: string, description: "Quote identifier if this session is based on a quote" }
        quote_expires_at: { type: string, format: date-time, description: "RFC 3339 timestamp when the quote expires" }
        discounts:
          $ref: "#/components/schemas/DiscountsResponse"
          description: "Discount extension: submitted codes and applied discounts. Present when the 'discount' extension is active."
      required:
        [
          id,
          status,
          currency,
          line_items,
          totals,
          fulfillment_options,
          messages,
          links,
          capabilities,
        ]
      example:
        id: "cs_abc123"
        protocol:
          version: "2026-01-30"
        capabilities:
          payment:
            handlers:
              - id: "handler_stripe_card"
                name: "dev.acp.tokenized.card"
                version: "2026-01-30"
                spec: "https://example.com/payment-handlers/tokenized-card"
                requires_delegate_payment: true
                requires_pci_compliance: false
                psp: "stripe"
                config_schema: "https://example.com/schemas/card-config.json"
                instrument_schemas: ["https://example.com/schemas/card-instrument.json"]
                config: {}
          interventions:
            supported: ["3ds"]
          extensions:
            - name: "discount@2026-01-30"
              extends: ["$.CheckoutSession.discounts"]
              schema: "https://example.com/extensions/discount/schema.json"
              spec: "https://example.com/extensions/discount/spec"
        status: "ready_for_payment"
        currency: "usd"
        line_items:
          - id: "li_001"
            item:
              id: "item_123"
              name: "Wireless Headphones"
              unit_amount: 7999
            quantity: 2
            name: "Premium Wireless Headphones"
            unit_amount: 7999
            availability_status: "in_stock"
            totals:
              - type: "subtotal"
                display_text: "Subtotal"
                amount: 15998
        totals:
          - type: "subtotal"
            display_text: "Subtotal"
            amount: 15998
          - type: "tax"
            display_text: "Sales Tax"
            amount: 1400
          - type: "total"
            display_text: "Total"
            amount: 17398
        fulfillment_options:
          - type: "shipping"
            id: "ship_standard"
            title: "Standard Shipping"
            carrier: "USPS"
            totals:
              - type: "fulfillment"
                display_text: "Shipping"
                amount: 599
        messages: []
        links:
          - type: "return_policy"
            title: "Return Policy"
            url: "https://example.com/returns"
        created_at: "2026-02-11T10:00:00Z"
        updated_at: "2026-02-11T10:05:00Z"
        expires_at: "2026-02-11T22:00:00Z"

    CheckoutSession:
      allOf:
        - $ref: "#/components/schemas/CheckoutSessionBase"

    CheckoutSessionWithOrder:
      allOf:
        - $ref: "#/components/schemas/CheckoutSessionBase"
        - type: object
          properties:
            order: { $ref: "#/components/schemas/Order" }
          required: [order]
      example:
        id: "cs_abc123"
        protocol:
          version: "2026-01-30"
        capabilities:
          payment:
            handlers:
              - id: "handler_stripe_card"
                name: "dev.acp.tokenized.card"
                version: "2026-01-30"
                spec: "https://example.com/payment-handlers/tokenized-card"
                requires_delegate_payment: true
                requires_pci_compliance: false
                psp: "stripe"
                config_schema: "https://example.com/schemas/card-config.json"
                instrument_schemas: ["https://example.com/schemas/card-instrument.json"]
                config: {}
          interventions:
            supported: ["3ds"]
          extensions:
            - name: "discount@2026-01-30"
              extends: ["$.CheckoutSession.discounts"]
              schema: "https://example.com/extensions/discount/schema.json"
              spec: "https://example.com/extensions/discount/spec"
        status: "completed"
        currency: "usd"
        line_items:
          - id: "li_001"
            item:
              id: "item_123"
              name: "Wireless Headphones"
              unit_amount: 7999
            quantity: 2
            name: "Premium Wireless Headphones"
            unit_amount: 7999
            availability_status: "in_stock"
            totals:
              - type: "subtotal"
                display_text: "Subtotal"
                amount: 15998
        totals:
          - type: "subtotal"
            display_text: "Subtotal"
            amount: 15998
          - type: "tax"
            display_text: "Sales Tax"
            amount: 1400
          - type: "total"
            display_text: "Total"
            amount: 17398
        fulfillment_options:
          - type: "shipping"
            id: "ship_standard"
            title: "Standard Shipping"
            carrier: "USPS"
            totals:
              - type: "fulfillment"
                display_text: "Shipping"
                amount: 599
        messages: []
        links:
          - type: "return_policy"
            title: "Return Policy"
            url: "https://example.com/returns"
        created_at: "2026-02-11T10:00:00Z"
        updated_at: "2026-02-11T10:30:00Z"
        order:
          id: "ord_123456"
          checkout_session_id: "cs_abc123"
          order_number: "ORD-2026-001"
          permalink_url: "https://example.com/orders/ord_123456"
          status: "confirmed"

    CheckoutSessionCreateRequest:
      type: object
      additionalProperties: false
      properties:
        buyer: { $ref: "#/components/schemas/Buyer", description: "Buyer information" }
        line_items:
          type: array
          items: { $ref: "#/components/schemas/Item" }
          minItems: 1
          description: "Items to add to the checkout session"
        currency: { type: string, description: "ISO 4217 currency code" }
        fulfillment_details: { $ref: "#/components/schemas/FulfillmentDetails", description: "Fulfillment contact and address details" }
        capabilities: { $ref: "#/components/schemas/Capabilities", description: "Agent capabilities and supported features" }
        fulfillment_groups:
          type: array
          items: { $ref: "#/components/schemas/FulfillmentGroup" }
          description: "Grouping of items by fulfillment method"
        affiliate_attribution:
          { $ref: "#/components/schemas/AffiliateAttribution", description: "Affiliate attribution data for first-touch tracking" }
        coupons:
          type: array
          items: { type: string }
          description: "DEPRECATED: Use discounts.codes instead. Discount codes to apply."
        discounts:
          $ref: "#/components/schemas/DiscountsRequest"
          description: Discount codes to apply to the checkout session.
        locale: { type: string, description: "Locale code for localizing content (e.g., 'en-US')" }
        timezone: { type: string, description: "IANA timezone identifier (e.g., 'America/New_York')" }
        quote_id: { type: string, description: "Quote identifier if this session is based on a quote" }
        metadata:
          type: object
          additionalProperties: true
          description: "Arbitrary metadata for merchant use"
      required: [line_items, currency, capabilities]
      example:
        line_items:
          - id: "item_123"
            name: "Wireless Headphones"
            unit_amount: 7999
        currency: "usd"
        capabilities:
          payment:
            handlers:
              - id: "handler_stripe_card"
                name: "dev.acp.tokenized.card"
                version: "2026-01-30"
                spec: "https://example.com/payment-handlers/tokenized-card"
                requires_delegate_payment: true
                requires_pci_compliance: false
                psp: "stripe"
                config_schema: "https://example.com/schemas/card-config.json"
                instrument_schemas: ["https://example.com/schemas/card-instrument.json"]
                config: {}
          interventions:
            supported: ["3ds"]
          extensions: ["discount"]

    CheckoutSessionUpdateRequest:
      type: object
      additionalProperties: false
      properties:
        buyer: { $ref: "#/components/schemas/Buyer", description: "Updated buyer information" }
        line_items:
          type: array
          items: { $ref: "#/components/schemas/Item" }
          description: "Items to update in the checkout session"
        fulfillment_details: { $ref: "#/components/schemas/FulfillmentDetails", description: "Updated fulfillment contact and address" }
        fulfillment_groups:
          type: array
          items: { $ref: "#/components/schemas/FulfillmentGroup" }
          description: "Updated fulfillment groupings"
        selected_fulfillment_options:
          type: array
          items: { $ref: "#/components/schemas/SelectedFulfillmentOption" }
          description: "Fulfillment option selected by the buyer"
        coupons:
          type: array
          items: { type: string }
          description: "DEPRECATED: Use discounts.codes instead. Discount codes to apply."
        discounts:
          $ref: "#/components/schemas/DiscountsRequest"
          description: Discount codes to apply. Replaces previously submitted codes.
      example:
        selected_fulfillment_options:
          - type: "shipping"
            option_id: "ship_standard"
            item_ids: ["li_001"]

    RiskSignals:
      type: object
      additionalProperties: false
      properties:
        ip_address: { type: string, description: "IP address of the buyer" }
        user_agent: { type: string, description: "User agent string of the buyer's browser" }
        accept_language: { type: string, description: "Accept-Language header from the buyer's browser" }
        session_id: { type: string, description: "Session identifier for the buyer" }
        device_fingerprint: { type: string, description: "Device fingerprint for fraud detection" }
      example:
        ip_address: "203.0.113.45"
        user_agent: "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)"
        accept_language: "en-US,en;q=0.9"
        session_id: "sess_abc123"
        device_fingerprint: "fp_xyz789"

    CheckoutSessionCompleteRequest:
      type: object
      additionalProperties: false
      properties:
        buyer: { $ref: "#/components/schemas/Buyer", description: "Final buyer information" }
        payment_data: { $ref: "#/components/schemas/PaymentData", description: "Payment method and details" }
        authentication_result:
          { $ref: "#/components/schemas/AuthenticationResult", description: "Authentication result for 3DS flows" }
        affiliate_attribution:
          { $ref: "#/components/schemas/AffiliateAttribution", description: "Affiliate attribution data for last-touch tracking" }
        risk_signals: { $ref: "#/components/schemas/RiskSignals", description: "Risk and fraud signals" }
      required: [payment_data]
      example:
        buyer:
          first_name: "John"
          last_name: "Smith"
          email: "johnsmith@mail.com"
        payment_data:
          handler_id: "handler_stripe_card"
          instrument:
            type: "card"
            credential:
              type: "spt"
              token: "spt_123"

    AuthenticationMetadata:
      type: object
      additionalProperties: true
      description: >
        Seller-provided authentication metadata for 3DS flows.
      required:
        - channel
        - acquirer_details
        - directory_server
      properties:
        channel:
          type: object
          additionalProperties: false
          description: Details about the channel used for this 3DS Authentication.
          required:
            - type
            - browser
          properties:
            type:
              type: string
              enum: [browser]
              description: Use "browser" to indicate the transaction originated from a browser.
            browser:
              type: object
              additionalProperties: false
              description: Browser details collected server- or client-side.
              properties:
                accept_header:
                  type: string
                  description: The HTTP Accept header from the cardholder’s browser.
                ip_address:
                  type: string
                  maxLength: 45
                  description: The IP address of the browser.
                javascript_enabled:
                  type: boolean
                  description: Whether the cardholder browser can execute JavaScript.
                language:
                  type: string
                  maxLength: 35
                  description: An IETF BCP 47 language tag representing the browser language.
                user_agent:
                  type: string
                  description: The browser user agent string.
                color_depth:
                  type: integer
                  description: The screen color depth. Required if javascript_enabled is true.
                java_enabled:
                  type: boolean
                  description: Browser Java support. Required if javascript_enabled is true.
                screen_height:
                  type: integer
                  description: Screen height in pixels. Required if javascript_enabled is true.
                screen_width:
                  type: integer
                  description: Screen width in pixels. Required if javascript_enabled is true.
                timezone_offset:
                  type: integer
                  description: Time difference in minutes between UTC and the browser local time. Required if javascript_enabled is true.
              required:
                - accept_header
                - ip_address
                - javascript_enabled
                - language
                - user_agent

        acquirer_details:
          type: object
          additionalProperties: false
          description: Details about the acquirer used for this 3DS Authentication. This object MUST be present.
          properties:
            acquirer_bin:
              type: string
              maxLength: 11
              description: The Acquirer BIN (directory-server specific).
            acquirer_country:
              type: string
              minLength: 2
              maxLength: 2
              description: Two-letter ISO 3166-1 alpha-2 country code.
            acquirer_merchant_id:
              type: string
              maxLength: 35
              description: The Merchant ID assigned by the acquirer.
            merchant_name:
              type: string
              maxLength: 40
              description: Merchant name assigned by the acquirer.
            requestor_id:
              type: string
              maxLength: 35
              description: Requestor ID (if required by the directory server).
          required:
            - acquirer_bin
            - acquirer_country
            - acquirer_merchant_id
            - merchant_name

        directory_server:
          type: string
          enum: [american_express, mastercard, visa]
          description: The 3DS directory server used for this Authentication.

        flow_preference:
          type: object
          additionalProperties: false
          description: >
            Contains additional details on the seller's preference for the 3DS
            authentication flow. Sellers MAY request a preference, but issuers
            ultimately decide the actual flow.
          properties:
            type:
              type: string
              enum: [challenge, frictionless]
              description: >
                Type of flow requested for this 3DS Authentication. "challenge"
                requests a challenge flow; "frictionless" requests a frictionless flow.
            challenge:
              type: object
              additionalProperties: false
              description: >
                Details about the requested challenge flow.
              properties:
                type:
                  type: string
                  enum: [mandated, preferred]
                  description: >
                    Subtype of challenge preference.
            frictionless:
              type: object
              additionalProperties: false
              description: >
                Details about the requested frictionless flow.
          required: [type]
      allOf:
        - if:
            properties:
              channel:
                properties:
                  browser:
                    properties:
                      javascript_enabled:
                        const: true
          then:
            properties:
              channel:
                properties:
                  browser:
                    required:
                      - color_depth
                      - java_enabled
                      - screen_height
                      - screen_width
                      - timezone_offset
      example:
        channel:
          type: "browser"
          browser:
            accept_header: "text/html,application/xhtml+xml"
            ip_address: "203.0.113.45"
            javascript_enabled: true
            language: "en-US"
            user_agent: "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)"
            color_depth: 24
            java_enabled: false
            screen_height: 1080
            screen_width: 1920
            timezone_offset: -480
        acquirer_details:
          acquirer_bin: "123456"
          acquirer_country: "US"
          acquirer_merchant_id: "merchant_123"
          merchant_name: "Example Store"
        directory_server: "visa"

    AuthenticationResult:
      type: object
      additionalProperties: false
      description: >
        Agent-provided authentication results returned to the seller for card-based 3D Secure.
      properties:
        outcome:
          type: string
          description: The outcome of this 3DS Authentication.
          enum:
            - abandoned
            - attempt_acknowledged
            - authenticated
            - canceled
            - denied
            - informational
            - internal_error
            - not_supported
            - processing_error
            - rejected
          example: "authenticated"
        outcome_details:
          type: object
          description: >
            Detailed authentication data. This field is required when the outcome is
            'authenticated', 'informational', or 'attempt_acknowledged'.
          additionalProperties: false
          properties:
            three_ds_cryptogram:
              type: string
              description: >
                The 3DS cryptogram (authentication value / AAV/CAVV/AEVV). This value is
                20 bytes, base64-encoded into a 28-character string.
              example: "AbCdEfGhIjKlMnOpQrStUvWxY0="
            electronic_commerce_indicator:
              type: string
              description: >
                Electronic Commerce Indicator (ECI) returned by the 3D Secure provider.
                Indicates the degree/type of authentication performed.
              enum: ["01", "02", "05", "06", "07"]
              example: "05"
            transaction_id:
              type: string
              description: >
                Transaction identifier returned by the 3DS system:
                - For 3DS1: the XID
                - For 3DS2: the Directory Server Transaction ID (dsTransID)
              example: "dsTransId_abc123"
            version:
              type: string
              description: >
                The 3D Secure version used for this authentication (for example "1.0.2" or "2.2.0").
              example: "2.2.0"
          required:
            - three_ds_cryptogram
            - electronic_commerce_indicator
            - transaction_id
            - version
      required:
        - outcome
      allOf:
        - if:
            properties:
              outcome:
                enum: [authenticated, informational, attempt_acknowledged]
          then:
            required: [outcome_details]
      example:
        outcome: "authenticated"
        outcome_details:
          three_ds_cryptogram: "AbCdEfGhIjKlMnOpQrStUvWxY0="
          electronic_commerce_indicator: "05"
          transaction_id: "dsTransId_abc123"
          version: "2.2.0"

    IntentTrace:
      type: object
      properties:
        reason_code:
          type: string
          description: |
            Reason for abandonment. This enum is extensible: servers SHOULD accept
            unrecognized values and treat them as "other" (see RFC Section 7.2).
            Validators SHOULD be configured for lenient enum handling.
          enum:
            - price_sensitivity
            - shipping_cost
            - shipping_speed
            - product_fit
            - trust_security
            - returns_policy
            - payment_options
            - comparison
            - timing_deferred
            - other
        trace_summary:
          type: string
          maxLength: 500
          description: A generated summary of the specific objection or negotiation gap.
        metadata:
          type: object
          additionalProperties:
            type: [string, number, boolean]
      required: [reason_code]
      example:
        reason_code: "price_sensitivity"
        trace_summary: "Customer mentioned the price was higher than expected and wanted to compare with other options"
        metadata:
          compared_sites: 3

    CancelSessionRequest:
      type: object
      properties:
        intent_trace: { $ref: "#/components/schemas/IntentTrace" }
      example:
        intent_trace:
          reason_code: "price_sensitivity"
          trace_summary: "Customer mentioned the price was higher than expected"

    Error:
      type: object
      additionalProperties: false
      description: |
        Protocol-level error returned in 4xx/5xx responses when the server cannot
        return a valid CheckoutSession at all (e.g. malformed request or unexpected
        failure). Use Error—not MessageError—when there is no valid session state
        to return. type semantics: invalid_request — malformed request, missing
        required fields, or invalid JSON; request_not_idempotent — idempotency
        violation; processing_error — unexpected server-side failure;
        service_unavailable — temporary unavailability.
      properties:
        type:
          {
            type: string,
            enum:
              [
                invalid_request,
                request_not_idempotent,
                processing_error,
                service_unavailable,
              ],
            description: "Error type indicating the category of protocol-level error"
          }
        code: { type: string, description: "Implementation-defined error code" }
        message: { type: string, description: "Human-readable error message" }
        param: { type: string, description: "RFC 9535 JSONPath (optional)" }
      required: [type, code, message]
      example:
        type: "invalid_request"
        code: "missing_required_field"
        message: "The 'currency' field is required"
        param: "$.currency"
